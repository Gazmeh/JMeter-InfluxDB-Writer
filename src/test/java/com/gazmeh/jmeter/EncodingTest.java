package com.gazmeh.jmeter;

import java.io.ByteArrayInputStream;
import java.nio.charset.Charset;

import org.bouncycastle.util.encoders.Hex;
import org.junit.Assert;
import org.junit.Test;

import com.jayway.jsonpath.Configuration;
import com.jayway.jsonpath.JsonPath;

public class EncodingTest {

    @Test
    public void testUtf32() {
	String charsetName = "UTF-32LE";
	Charset charset = Charset.forName(charsetName);
	byte[] buff = "{\"Body\":{\"DateTime\":\"date-time\"}}".getBytes(charset);

	// maso, 2018: decode and fill the point
	Object document = Configuration//
		.defaultConfiguration()//
		.jsonProvider()//
		.parse(new ByteArrayInputStream(buff), charsetName);

	// local date time
	String localTimeStr = JsonPath.read(document, "$.Body.DateTime");
	Assert.assertNotNull(localTimeStr);
    }

    @Test
    public void testJson() {
	String data = "7b000000220000005400000069000000630000006b00000065000000740000004900000064000000220000003a000000300000002c0000002200000048000000650000006100000064000000650000007200000073000000220000003a0000006e000000750000006c0000006c0000002c00000022000000420000006f0000006400000079000000220000003a0000007b0000002200000054000000700000006400000075000000220000003a0000006e000000750000006c0000006c0000002c000000220000004b000000650000007900000054000000790000007000000065000000220000003a000000300000002c00000022000000430000006100000072000000640000004e0000006f000000220000003a0000002200000036000000300000003300000037000000390000003900000037000000320000003500000039000000380000003800000039000000330000003100000030000000220000002c0000002200000050000000720000006f00000063000000650000007300000073000000690000006e00000067000000430000006f0000006400000065000000220000003a00000022000000300000003000000030000000300000003000000030000000220000002c00000022000000410000006d0000006f000000750000006e00000074000000220000003a0000003600000036000000350000003500000034000000360000002e000000300000002c000000220000004400000061000000740000006500000054000000690000006d00000065000000220000003a00000022000000320000003000000031000000380000002d00000031000000300000002d00000033000000310000005400000031000000310000003a00000030000000380000003a00000033000000350000002e0000003900000033000000330000002b00000030000000330000003a0000003300000030000000220000002c0000002200000053000000790000007300000074000000650000006d00000054000000720000006100000063000000650000004e0000006f000000220000003a00000022000000300000003000000032000000300000003000000030000000220000002c000000220000004e0000004900000049000000220000003a0000006e000000750000006c0000006c0000002c000000220000004c0000006f00000063000000610000006c00000054000000690000006d00000065000000220000003a0000002200000031000000310000003a00000030000000380000003a00000033000000350000002e00000039000000330000003300000030000000300000003000000030000000220000002c000000220000004c0000006f00000063000000610000006c00000044000000610000007400000065000000220000003a00000022000000320000003000000031000000380000002d00000031000000300000002d00000033000000310000005400000030000000300000003a00000030000000300000003a00000030000000300000002b00000030000000330000003a0000003300000030000000220000002c000000220000004400000061000000740000006500000043000000610000007000000074000000750000007200000065000000220000003a00000022000000320000003000000031000000380000002d00000031000000300000002d00000031000000390000005400000030000000330000003a00000033000000300000003a00000030000000300000002b00000030000000330000003a0000003300000030000000220000002c00000022000000410000006300000071000000430000006f0000006400000065000000220000003a000000220000003100000032000000330000003400000035000000360000003700000038000000390000003100000032000000220000002c00000022000000490000007300000073000000430000006f0000006400000065000000220000003a000000220000003100000032000000330000003400000035000000360000003700000038000000390000003100000032000000220000002c00000022000000530000006500000074000000740000006c000000650000006d000000650000006e0000007400000044000000610000007400000065000000220000003a00000022000000300000003000000030000000310000002d00000030000000310000002d00000030000000310000005400000030000000300000003a00000030000000300000003a0000003000000030000000220000002c00000022000000520000006500000074000000720000006900000076000000610000006c0000005200000065000000660000004e0000006f000000220000003a0000006e000000750000006c0000006c0000002c000000220000005400000065000000720000006d000000690000006e000000610000006c0000004900000064000000220000003a000000220000003700000030000000320000003500000035000000310000003300000039000000220000002c00000022000000430000006100000072000000640000004100000063000000710000004900000064000000220000003a00000022000000300000003000000030000000300000003000000030000000360000003600000036000000310000003700000030000000310000003300000037000000220000002c000000220000004100000063000000710000004e000000610000006d00000065000000220000003a0000006e000000750000006c0000006c0000002c0000002200000041000000640000006400000044000000610000007400000061000000220000003a0000006e000000750000006c0000006c0000002c0000002200000043000000750000007200000072000000650000006e0000006300000079000000430000006f0000006400000065000000220000003a00000022000000330000003600000034000000220000002c000000220000004100000064000000640000006900000074000000690000006f0000006e000000610000006c000000410000006d0000006f000000750000006e00000074000000220000003a0000006e000000750000006c0000006c0000002c00000022000000430000006f000000750000006e000000740000007200000079000000430000006f0000006400000065000000220000003a00000022000000330000003600000034000000220000002c000000220000005300000065000000630000007500000072000000690000007400000079000000430000006f0000006e00000074000000720000006f0000006c000000490000006e000000660000006f000000220000003a0000006e000000750000006c0000006c0000002c000000220000004e0000006500000074000000770000006f000000720000006b0000004d000000610000006e0000006100000067000000650000006d000000650000006e00000074000000490000006e000000660000006f000000430000006f0000006400000065000000220000003a0000006e000000750000006c0000006c0000002c00000022000000520000006500000063000000650000006900000076000000690000006e00000067000000490000006e0000007300000074000000220000003a0000006e000000750000006c0000006c0000002c000000220000004d0000006500000073000000730000006100000067000000650000005300000065000000630000007500000072000000690000007400000079000000430000006f0000006400000065000000220000003a0000006e000000750000006c0000006c0000002c00000022000000520000006500000073000000700000006f0000006e0000007300000065000000430000006f0000006400000065000000220000003a000000220000003300000030000000220000002c000000220000005000000072000000690000007600000061000000740000006500000031000000220000003a0000006e000000750000006c0000006c0000002c000000220000005000000072000000690000007600000061000000740000006500000033000000220000003a0000006e000000750000006c0000006c0000002c000000220000005000000072000000690000007600000061000000740000006500000034000000220000003a0000006e000000750000006c0000006c0000002c000000220000004b0000006500000079000000490000006e000000640000006500000078000000220000003a000000300000002c000000220000004f000000720000006900000067000000690000006e000000610000006c00000044000000610000007400000061000000220000003a0000006e000000750000006c0000006c0000002c000000220000004100000064000000640000006900000074000000690000006f0000006e000000610000006c000000520000006500000073000000700000006f0000006e000000730000006500000044000000610000007400000061000000220000003a0000006e000000750000006c0000006c0000002c000000220000005400000072000000610000006e00000073000000700000006f000000720000007400000044000000610000007400000061000000220000003a0000006e000000750000006c0000006c0000002c000000220000004d0000004300000043000000220000003a0000006e000000750000006c0000006c0000002c00000022000000410000006d0000006f000000750000006e00000074000000410000006300000071000000220000003a0000006e000000750000006c0000006c0000002c00000022000000490000007300000073000000750000006500000072000000410000006d0000006f000000750000006e00000074000000220000003a0000006e000000750000006c0000006c0000002c0000002200000045000000780000006300000068000000610000006e000000670000006500000052000000610000007400000065000000220000003a0000006e000000750000006c0000006c0000002c0000002200000045000000780000006300000068000000610000006e000000670000006500000052000000610000007400000065000000410000006300000071000000220000003a0000006e000000750000006c0000006c0000002c000000220000005300000065000000740000007400000043000000750000007200000072000000650000006e0000006300000079000000430000006f0000006400000065000000220000003a0000006e000000750000006c0000006c0000002c0000002200000049000000730000007300000075000000650000007200000043000000750000007200000072000000650000006e0000006300000079000000430000006f0000006400000065000000220000003a0000006e000000750000006c0000006c0000002c0000002200000041000000750000007400000068000000490000006400000052000000650000007300000070000000220000003a0000006e000000750000006c0000006c0000002c00000022000000520000006500000063000000650000006900000076000000690000006e00000067000000490000006e00000073000000740000004900000064000000220000003a0000006e000000750000006c0000006c0000002c00000022000000500000006f00000073000000430000006f0000006e000000640000006900000074000000690000006f0000006e000000220000003a0000006e000000750000006c0000006c0000002c0000002200000045000000780000007000000069000000720000006500000044000000610000007400000065000000220000003a0000006e000000750000006c0000006c0000002c00000022000000500000006f00000073000000450000006e0000007400000072000000790000004d0000006f0000006400000065000000220000003a0000006e000000750000006c0000006c0000002c0000002200000050000000690000006e00000043000000610000007000000074000000750000007200000065000000430000006f0000006400000065000000220000003a0000006e000000750000006c0000006c0000002c0000002200000043000000760000007600000032000000220000003a0000006e000000750000006c0000006c0000002c00000022000000540000007200000061000000630000006b00000032000000220000003a0000006e000000750000006c0000006c0000002c0000002200000050000000690000006e000000220000003a0000006e000000750000006c0000006c0000002c000000220000004d000000730000006700000054000000790000007000000065000000220000003a0000002200000030000000320000003100000030000000220000002c000000220000004d0000006100000063000000220000003a000000220000004600000044000000410000004100000042000000300000004300000036000000380000004300000044000000410000004600000031000000410000004600000044000000440000004100000046000000440000003400000042000000340000003400000030000000310000004200000035000000350000003700000046000000220000002c0000002200000052000000610000007700000049000000730000006f000000220000003a0000006e000000750000006c0000006c0000002c000000220000004300000068000000610000006e0000006e000000650000006c0000004e0000006f00000064000000650000004900000064000000220000003a000000380000002c00000022000000430000006f0000006e0000006e000000650000006300000074000000690000006f0000006e0000004b0000006500000079000000220000003a0000002200000030000000300000003000000030000000300000003000000030000000300000002d000000300000003000000030000000300000002d000000300000003000000030000000300000002d000000300000003000000030000000300000002d000000300000003000000030000000300000003000000030000000300000003000000030000000300000003000000030000000220000007d0000002c00000022000000530000006f000000750000007200000063000000650000004e0000006f00000064000000650000004900000064000000220000003a000000300000002c0000002200000044000000650000007300000074000000690000006e0000006100000074000000690000006f0000006e0000004e0000006f00000064000000650000004900000064000000220000003a000000360000002c000000220000005400000061000000720000006700000065000000740000004300000068000000610000006e0000006e000000650000006c0000004e0000006f00000064000000650000004900000064000000220000003a000000380000002c00000022000000430000006f0000006e0000006e000000630000006500000074000000690000006f0000006e0000004b0000006500000079000000220000003a0000002200000030000000300000003000000030000000300000003000000030000000300000002d000000300000003000000030000000300000002d000000300000003000000030000000300000002d000000300000003000000030000000300000002d000000300000003000000030000000300000003000000030000000300000003000000030000000300000003000000030000000220000002c000000220000004d000000650000007300000073000000610000006700000065000000440000006900000072000000650000006300000074000000690000006f0000006e000000220000003a000000300000002c000000220000004d0000006500000073000000730000006100000067000000690000006e000000670000005000000061000000740000007400000065000000720000006e000000220000003a000000300000002c000000220000004100000063000000630000006500000070000000740000006f000000720000004b0000006500000079000000220000003a0000002200000045000000640000006700000065000000220000007d000000";

	String charsetName = "UTF-32LE";
	byte[] buff = Hex.decode(data);

	// maso, 2018: decode and fill the point
	Object document = Configuration//
		.defaultConfiguration()//
		.jsonProvider()//
		.parse(new ByteArrayInputStream(buff), charsetName);

	// local date time
	String localTimeStr = JsonPath.read(document, "$.Body.DateTime");
	Assert.assertNotNull(localTimeStr);
    }
}
